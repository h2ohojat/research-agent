/* =========================================================
   Pyamooz AI — Chat UI (cleaned & optimized)
   ========================================================= */

/* ---------- Design Tokens ---------- */
:root{
  --gap:12px;
  --primary-color:#0090ff;
  --primary-light:#eaf2ff;
  --primary-border:#7aa7ff;

  --bg-body:#f8f9fa;
  --bg-surface:#fff;
  --bg-hover:#f0f7ff;

  --border:#ddd;
  --border-light:#e3e3e3;

  --text:#222;
  --text-2:#444;
  --text-3:#666;
  --text-4:#777;

  --shadow:0 2px 8px rgba(0,0,0,0.1);

  --radius:12px;
  --radius-sm:8px;

  /* توسط JS ست می‌شود؛ مقدار پیش‌فرض برای فالو‌بک */
  --composer-height:84px;
}

/* ---------- Base ---------- */
html,body{height:100%}
body{
  font-family:Tahoma,Arial,sans-serif;
  margin:0;
  padding:0;
  background:var(--bg-body);
  color:var(--text);
  line-height:1.6;
}

/* ---------- Container for content centering ---------- */
.container{
  max-width:1200px; 
  margin:0 auto;
  padding:24px 16px;
}

/* ---------- Topbar (full-width background) ---------- */
.topbar-wrapper{
  width:100%;
  background:var(--bg-surface);
  border-bottom:1px solid var(--border-light);
  box-shadow:var(--shadow);
  margin-bottom:16px;
}

.topbar{
  display:flex; 
  justify-content:space-between; 
  align-items:center;
  max-width:1200px;
  margin:0 auto;
  padding:10px 16px;
}

.topbar__left{display:flex; align-items:center; gap:12px;}
.brand{font-weight:700; color:var(--text); text-decoration:none; font-size:18px;}
.brand-accent{color:var(--primary-color)}
.divider{width:1px; height:20px; background:var(--border-light)}
.model-controls{display:flex; align-items:center; gap:8px; font-size:14px;}
.user-info--compact{font-size:14px}
.btn-link{background:transparent; border:none; color:var(--primary-color); cursor:pointer; padding:2px 6px; text-decoration:underline;}
.btn-link:hover{background:rgba(0,144,255,0.08)}

/* Theme toggle icons (sun/moon) */
.icon{display:block}
.icon-btn{
  display:inline-grid; place-items:center;
  width:36px; height:36px; border-radius:10px;
  background:transparent; border:1px solid var(--border-light);
  cursor:pointer;
}
.icon-btn:hover{ background:var(--bg-hover) }
.icon--moon{ display:none }
:root[data-theme="dark"] .icon--sun{ display:none }
:root[data-theme="dark"] .icon--moon{ display:block }

/* ---------- Layout ---------- */
.layout{
  display:flex; gap:var(--gap); align-items:flex-start;
  background:var(--bg-surface);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:visible;            /* برای sticky composer */
  min-height:70vh;
  max-width:1200px;
  margin:0 auto;
}

.sidebar{
  width:300px; max-height:70vh; overflow:auto;
  border-inline-end:1px solid var(--border);
  padding:16px; background:#f8f9fa;
}
.sidebar h3{margin:0 0 16px 0; font-size:18px; color:var(--text-2); font-weight:600}
.conv{display:flex; flex-direction:column; gap:8px}
.conv-item{
  padding:12px 14px; border-radius:var(--radius-sm); border:1px solid var(--border-light);
  background:#fff; cursor:pointer; transition:all .2s ease;
}
.conv-item:hover{background:var(--bg-hover); border-color:var(--primary-border); transform:translateY(-1px); box-shadow:0 2px 4px rgba(0,0,0,.1)}
.conv-item.active{border-color:var(--primary-border); background:var(--primary-light); box-shadow:0 2px 4px rgba(0,144,255,.2)}
.conv-item .ttl{font-size:14px; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-weight:500; margin-bottom:4px}
.conv-item .meta{font-size:12px; color:var(--text-4)}

.sidebar-buttons{display:flex; gap:8px; margin-top:16px}
.sidebar-buttons button{
  flex:1; padding:8px 12px; font-size:13px; background:#fff; color:var(--text-2);
  border:1px solid var(--border-light); border-radius:var(--radius-sm);
}
.sidebar-buttons button:hover{background:var(--primary-light); color:var(--primary-color); border-color:var(--primary-border)}

.content{
  flex:1; 
  padding:20px; 
  display:flex; 
  flex-direction:column; 
  align-items:stretch;
  position:relative;
}
.subtitle{color:var(--text-3); margin-top:-8px; margin-bottom:20px; font-size:15px; font-weight:500}

/* ---------- Messages ---------- */
.msg{
  position:relative;
  padding:12px 16px;
  border-radius:var(--radius);
  margin:10px 0;
  line-height:1.7;
  box-shadow:0 1px 3px rgba(0,0,0,.1);
}
.user{background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%); border-inline-start:4px solid var(--primary-color); margin-inline-start:40px}
.assistant{background:linear-gradient(135deg,#f1f8e9 0%,#dcedc8 100%); border-inline-start:4px solid #4caf50; margin-inline-end:40px}
.sys{background:linear-gradient(135deg,#fff3e0 0%,#ffe0b2 100%); border-inline-start:4px solid #ff9800; text-align:center; font-style:italic}
.meta{
  font-size:12px; color:var(--text-3); margin-top:8px; padding-top:8px; border-top:1px solid rgba(0,0,0,.1);
  background:rgba(255,255,255,.5); border-radius:4px; padding:6px 8px;
}

/* Message actions (Copy) */
.msg-actions{
  position:absolute; top:8px; inset-inline-start:8px;
  display:none; gap:6px;
}
.msg:hover .msg-actions{ display:flex; }
.msg-action{
  padding:4px 8px; border:1px solid var(--border-light);
  border-radius:8px; background:#fff; color:var(--text-2);
  font-size:12px; cursor:pointer;
}
.msg-action:hover{ background:var(--bg-hover); }

/* ---------- Markdown ---------- */
pre, code, .ltr{direction:ltr; unicode-bidi:plaintext} /* برای کد و URL */

.markdown-body{ line-height:1.8; word-wrap:break-word }
.markdown-body p{ margin:.5rem 0 }
.markdown-body h1,.markdown-body h2,.markdown-body h3{ margin:.8rem 0 .4rem; font-weight:700 }
.markdown-body code{ background:rgba(0,0,0,.06); padding:.1rem .35rem; border-radius:6px }
:root[data-theme="dark"] .markdown-body code{ background:rgba(255,255,255,.08) }

.markdown-body pre{
  position:relative; border-radius:12px; overflow:auto;
  direction:ltr; unicode-bidi:plaintext;
  background:rgba(0,0,0,.05);
}
:root[data-theme="dark"] .markdown-body pre{ background:rgba(255,255,255,.06) }
.markdown-body pre code{ display:block; padding:12px 16px; line-height:1.7 }

/* Code copy button (small & precise) */
.markdown-body pre{ padding-top:34px }
.code-copy-btn{
  position:absolute; top:6px; inset-inline-end:6px;
  font-size:12px !important; line-height:1 !important; padding:4px 8px !important;
  border:1px solid var(--border-light) !important; border-radius:8px !important;
  background:var(--bg-surface) !important; color:var(--text-2) !important;
  cursor:pointer;
}
.code-copy-btn:hover{ background:var(--bg-hover) !important; }

/* ---------- Composer (search-like pill) ---------- */
#composer{ 
  width:100%; 
  align-self:stretch;
}

.composer{
  position:sticky; 
  bottom:0; 
  left:0;
  right:0;
  z-index:50;
  padding:12px 12px calc(env(safe-area-inset-bottom,0) + 12px);
  background:transparent;
  border-radius:16px 16px 0 0;
}

.composer-bar{
  width:100%; 
  max-width:1200px;
  margin:0 auto;
  box-sizing:border-box;
  display:grid; 
  grid-template-columns:auto 1fr auto; 
  align-items:center; 
  gap:8px;

  background:var(--bg-surface);
  border:1px solid var(--border-light);
  border-radius:9999px;                 /* pill */
  padding:8px 8px;
  box-shadow:var(--shadow);
}
.composer-bar:focus-within{
  border-color:var(--primary-border);
  box-shadow:0 0 0 4px rgba(0,144,255,.08);
}

/* Textarea inside pill */
#composer #inp{
  border:0; outline:none; background:transparent; color:var(--text);
  width:100%; min-height:40px; max-height:35vh; line-height:1.6;
  padding:10px 0; resize:none; overflow-y:hidden;
  flex:1 1 auto; min-width:0;
}

/* Inline actions (mic / send) */
.composer-actions-inline{ display:inline-flex; align-items:center; gap:6px; }

/* Icon buttons (small — inside pill) */
#composer .icon-btn{
  width:36px; height:36px; min-width:0 !important; padding:0 !important;
  border:1px solid transparent !important; border-radius:9999px;
  display:inline-grid; place-items:center;
  background:transparent; color:var(--text-2);
  cursor:pointer;
}
#composer .icon-btn--ghost:hover{ background:var(--bg-hover); }
#composer .icon-btn--primary{ background:var(--primary-color); color:#fff; box-shadow:var(--shadow); }
#composer .icon-btn--primary:hover{ filter:brightness(.95); }

/* Extra actions under pill (اختیاری) */
.composer-actions-extra{ 
  margin-top:8px; 
  display:flex; 
  gap:8px;
  max-width:1200px;
  margin-left:auto;
  margin-right:auto;
}
.hidden{ display:none !important; }
.btn-secondary{
  background:var(--bg-surface); color:var(--text-2);
  border:1px solid var(--border-light); border-radius:8px; padding:8px 12px;
}
.btn-secondary:hover{ background:var(--bg-hover); }
.btn-primary[disabled], .btn-secondary[disabled]{ opacity:.6; cursor:not-allowed; }

/* Main list should leave space for sticky composer */
#list{ 
  flex:1 1 auto; 
  padding-bottom: var(--composer-offset, 96px);
  overflow-y:auto;
}

/* ---------- Jump-to-bottom FAB (centered above composer) ---------- */
#jumpToBottom{
  position:fixed;
  z-index:99;
  left:50%;
  transform:translateX(-50%);
  bottom:calc(var(--composer-height, 84px) + env(safe-area-inset-bottom,0) + 10px);

  width:48px; 
  height:48px;
  display:none;                       /* با کلاس .show ظاهر می‌شود */
  padding:0; 
  border:none; 
  border-radius:9999px;
  background:var(--primary-color); 
  color:#fff;
  place-items:center; 
  line-height:0;
  box-shadow:var(--shadow); 
  cursor:pointer;
}
#jumpToBottom.show{ display:grid }
#jumpToBottom svg{ width:22px; height:22px; pointer-events:none }
#jumpToBottom:hover{ 
  transform:translateX(-50%) translateY(-2px); 
  box-shadow:0 6px 16px rgba(0,0,0,.15) 
}
#jumpToBottom:active{ transform:translateX(-50%) translateY(-1px) }

/* ---------- User cluster (avatar + name + logout) ---------- */
.user-cluster{ display:flex; align-items:center; gap:10px; }
.avatar{
  width:32px; height:32px; border-radius:50%;
  object-fit:cover; border:1px solid var(--border-light); background:#ddd;
}
.avatar--fallback{
  display:inline-flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:700; color:#fff;
  background:linear-gradient(135deg,#5a8cff,#2d6bff);
}
.user-meta{display:flex; align-items:center; gap:8px; white-space:nowrap}
.user-greet{font-size:14px; color:var(--text-2)}

/* ---------- Dark Theme ---------- */
:root[data-theme="dark"]{
  --bg-body:#0f141a;
  --bg-surface:#141a21;
  --bg-hover:#18212b;
  --border:#2a3440;
  --border-light:#2a3440;
  --text:#e5edf5;
  --text-2:#c8d2dc;
  --text-3:#a9b4bf;
  --text-4:#8994a1;
  --primary-light:#0f2236;
  --shadow:0 2px 8px rgba(0,0,0,0.4);
}
:root[data-theme="dark"] body{ background:var(--bg-body); color:var(--text) }
:root[data-theme="dark"] .topbar-wrapper,
:root[data-theme="dark"] .layout,
:root[data-theme="dark"] .sidebar,
:root[data-theme="dark"] .content .msg{ background:var(--bg-surface); border-color:var(--border-light); }
:root[data-theme="dark"] .msg-action{ background:var(--bg-surface); color:var(--text-2); border-color:var(--border-light); }
:root[data-theme="dark"] .code-copy-btn{ background:var(--bg-surface) !important; color:var(--text-2) !important; border-color:var(--border-light) !important; }
:root[data-theme="dark"] #jumpToBottom{ background:#2563eb; }

/* ---------- Login with Google (wide icon button) ---------- */
.btn-google{
  display:inline-flex; align-items:center; gap:8px;
  height:36px; padding:0 12px;
  border:1px solid var(--border-light); border-radius:10px;
  background:#fff; color:var(--text-2); text-decoration:none; cursor:pointer;
}
.btn-google:hover{ background:var(--bg-hover) }
:root[data-theme="dark"] .btn-google{ background:var(--bg-surface); color:var(--text-2); border-color:var(--border-light) }

/* ---------- Responsive ---------- */
@media (max-width:768px){
  .container{
    padding:12px 8px;
  }
  
  .topbar{
    padding:10px 8px;
  }
  
  .layout{
    flex-direction:column;
    margin:0 8px;
  }
  
  .sidebar{
    width:100%; 
    max-height:200px; 
    border-inline-end:none; 
    border-bottom:1px solid var(--border);
  }
  
  .model-controls{
    flex-wrap:wrap;
  }
  
  #composer #inp{ 
    max-height:30vh;
  }
  
  .composer-bar{
    margin:0 8px;
  }
  
  .composer-actions-extra{
    margin-left:8px;
    margin-right:8px;
  }
}